#MIN_CONFIG(3.0.0)

AM_INIT_AUTOMAKE(ktoshiba, 0.8)
AC_C_BIGENDIAN
AC_CHECK_KDEMAXPATHLEN

dnl === powersave daemon support check - begin ===
AC_ARG_WITH(powersave,
    AS_HELP_STRING([--without-powersave], [build without powersave daemon support (default=no)]),
    [ac_cv_use_powersave=$withval],
    [ac_cv_use_powersave=yes]
)

if test "$ac_cv_use_powersave" = "yes"; then
    AC_CHECK_LIB(powersave_dbus, dbusSendSimpleMessage, [
	POWERSAVE_LIBS="-lpowersave -lpowersave_dbus"
	AC_CHECK_PROG(PKGCONFIG, [pkg-config], [pkg-config], [])
	PKG_CHECK_MODULES(DBUS, [dbus-1 >= 0.33])
	PKG_CHECK_MODULES(HAL, [hal >= 0.5.4])
	have_powersave=true
    ])

    if test "$have_powersave" = "true"; then
	AC_DEFINE(ENABLE_POWERSAVE, 1, [defined if you have powersave headers and libraries])
    else
	AC_MSG_WARN([You are missing the powersave headers and libraries. The powersave support won't be compiled])
    fi

    AC_SUBST(POWERSAVE_LIBS)
    AC_SUBST(DBUS_CFLAGS)
    AC_SUBST(DBUS_LIBS)
fi

AC_OUTPUT
dnl === powersave daemon support check - end ===
