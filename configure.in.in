#MIN_CONFIG(3.2.0)

AM_INIT_AUTOMAKE(ktoshiba, 0.11, coproscefalo@gmail.com)
AC_C_BIGENDIAN
AC_CHECK_KDEMAXPATHLEN


dnl === dbus support check - begin ===
PKG_CHECK_MODULES(DBUS, [dbus-1 >= 0.33], [have_dbus=yes],
    [have_dbus=no])

AC_SUBST(DBUS_CFLAGS)
AC_SUBST(DBUS_LIBS)

if test "$have_dbus" = "yes"; then
    # get dbus system bus socket
    DBUS_SYSTEM_BUS_SOCKET="`pkg-config --variable=system_bus_default_address dbus-1`"
    if test -z "$DBUS_SYSTEM_BUS_SOCKET"; then
        # use default
        DBUS_SYSTEM_BUS_SOCKET="unix:path=/var/run/dbus/system_bus_socket"
    fi

    AC_DEFINE_UNQUOTED(DBUS_SYSTEM_BUS_SOCKET, ["$DBUS_SYSTEM_BUS_SOCKET"],
        [D-BUS system bus socket path])

    # check for dbus qt bindings --> copied from KNetworkmanager
    safe_CPPFLAGS=$CPPFLAGS
    CPPFLAGS="$CPPFLAGS $DBUS_CFLAGS $all_includes"
    AC_LANG_SAVE
    AC_LANG_CPLUSPLUS
    AC_CHECK_HEADER(dbus/connection.h, [],
        [AC_MSG_ERROR(You need D-BUS/Qt3 bindings, [])
    ], [])
    AC_CHECK_HEADER(dbus/message.h, [],
        [AC_MSG_ERROR(You need D-BUS/Qt3 bindings, [])
    ], [])
    CPPFLAGS=$safe_CPPFLAGS
    AC_LANG_RESTORE
fi
dnl === dbus support check - end ===


dnl === libsynaptics support check - begin ===
AC_ARG_WITH(libsynaptics,
    AS_HELP_STRING([--without-libsynaptics], [build without libsynaptics support (default=yes)]),
    [ac_cv_use_synaptics=$withval],
    [ac_cv_use_synaptics=no]
)

if test "$ac_cv_use_synaptics" = "yes"; then
    SYNAPTICS="-lsynaptics -lXext -lXtst"

    AC_DEFINE(ENABLE_SYNAPTICS, 1, [defined if you have libsynaptics support enabled])
    AC_SUBST(SYNAPTICS)
fi
dnl === libsynaptics support check - end ===


dnl === omnibook support check - begin ===
AC_ARG_WITH(omnibook,
    AS_HELP_STRING([--without-omnibook], [build without omnibook support (default=no)]),
    [ac_cv_use_omnibook=$withval],
    [ac_cv_use_omnibook=yes]
)

if test "$ac_cv_use_omnibook" = "yes"; then
    AC_DEFINE(ENABLE_OMNIBOOK, 1, [defined if you have omnibook support enabled])
fi

AM_CONDITIONAL(with_keyhandler, [test x$ac_cv_use_omnibook = xyes])
dnl === omnibook support check - end ===


AC_SUBST(XGETTEXT)
